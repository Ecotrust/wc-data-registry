wc-data-registry
================

Data Registry for the West Coast Governors Alliance

# Quick Start
Install Jekyll site generator (may need to install ruby and gem first):

```
gem install jekyll
```

Install Bower package manager (may need to install node and npm first):

```
npm install -g bower
```
    
Install Grunt task runner:

```
sudo npm install -g grunt-cli
```

Clone this repository if you haven't already and cd into the top-level directory.

Install dev dependencies into node_modules directory:

```
npm install
```

Install frontend Javascript libraries into bower_components:

```
bower install
``` 

## (Optionally) Run tests

To successfully run tests you must implement the following workaround fix - http://stackoverflow.com/questions/24270389/angularjs-controller-unit-test-with-jasmine. In _includes/bower_components/angular-mocks/angular-mocks.js find the function isSpecRunning and change it as follows:

```
function isSpecRunning() {
  //return currentSpec && (window.mocha || currentSpec.queue.running);
  return !!currentSpec;
}
```

Now run the test suite

```
grunt test
```

## Serving The App

The following Jekyll command will compile the source code from site_raw into _site_generated, and start serving the app locally on port 4000.  It will also watch for file changes in site_raw and recompile automatically.

```
jekyll serve --watch
```

You should now be able to view the home page in your browser at http://127.0.0.1:4000

Last step.  If you don't have a local instance of Geoportal and SOLR running, for example if you are running a local development version, you will need to change where this app looks to connect to them.

To change the URL that the app connects to for Geoportal change scope.geoportalUrl in:
```
site_raw/_includes/js/directives/Results.js
```

To change the URL that the app connects to for SOLR change solrUrl in:
```
site_raw/_includes/js/services/Solr.js
```

If you set those URL's to a domain that is different than this application then you will get cross-domain AJAX errors.  One workaround is to temporarily allow cross-domain AJAX requests using a CORS plugin such as the "Allow-Control-Allow-Origin" extension for Chrome.  Make sure you turn this off when you're done. 

# Getting Ready For Staging/Production

To reduce the size of the JS and CSS files (minify/uglify) and get them ready for staging and production, run the default grunt task:

```
grunt
```

This is best done directly on the staging server.

### Compiling LESS to CSS
You should not make changes directly to site_raw/_includes/css/main.css.  This stylesheet is generated by the LESS compiler.  You shoule make edits to site_raw/_includes/less/main.less and then run:

```
less site_raw/_includes/less/main.less site_raw/_includes/css/main.css
```